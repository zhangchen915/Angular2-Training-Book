<!DOCTYPE html>
<html lang="en">
  <head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">

    <title>Angular Training Book |  </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <!-- fonts -->
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet">

    <!-- stylesheets -->
    <link rel="stylesheet" href="/style/doc.css">

    <!-- favicon -->
    <link rel="icon" href="/images/favicon.ico">

    

  </head>
  <body>

   <script>window.__INITIAL_STATE__ = {"page":{"path":"zone/zone.html","title":""},"data":{"navigation":{"logo":{"text":"Angular","type":"link","path":"index.html"},"main":[{"text":"License","type":"link","path":"license.html"},{"text":"Why Angular ? ","type":"link","path":"why_angular_2.html"},{"text":"为什么不是React⚡️","type":"link","path":"vs_react.html"},{"text":"聊聊技术选型-Angular vs Vue⚡️","type":"link","path":"vs_vue2.html"},{"text":"ES6和TypeScript的特点","type":"link","path":"ES6&TypeScript/ES6&TypeScript.html","children":[{"text":"ES6","type":"link","path":"ES6&TypeScript/es6/es6.html"},{"text":"Classes","type":"link","path":"ES6&TypeScript/es6/classes.html"},{"text":"回顾 `this`","type":"link","path":"ES6&TypeScript/es6/refresher_on_this.html"},{"text":"箭头函数","type":"link","path":"ES6&TypeScript/es6/arrow_functions.html"},{"text":"模板字符串","type":"link","path":"ES6&TypeScript/es6/template_strings.html"},{"text":"继承","type":"link","path":"ES6&TypeScript/es6/inheritance.html"},{"text":"委托","type":"link","path":"ES6&TypeScript/es6/delegation.html"},{"text":"常量和块作用域变量","type":"link","path":"ES6&TypeScript/es6/constants_and_block_scoped_variables.html"},{"text":"扩展语句和剩余参数","type":"link","path":"ES6&TypeScript/es6/spread_and_rest.html"},{"text":"解构","type":"link","path":"ES6&TypeScript/es6/destructuring.html"},{"text":"模块","type":"link","path":"ES6&TypeScript/es6/es6_modules.html"},{"text":"TypeScript","type":"link","path":"ES6&TypeScript/typescript/typeScript.html"},{"text":"TypeScript入门","type":"link","path":"ES6&TypeScript/typescript/typeScript_start.html"},{"text":"使用 tsc","type":"link","path":"ES6&TypeScript/typescript/working_with_tsc.html"},{"text":"Linting","type":"link","path":"ES6&TypeScript/typescript/linting.html"},{"text":"类型⚡️","type":"link","path":"ES6&TypeScript/typescript/typings.html"},{"text":"TypeScript特性","type":"link","path":"ES6&TypeScript/typescript/typescript_features.html"},{"text":"TypeScript类","type":"link","path":"ES6&TypeScript/typescript/typescript_classes.html"},{"text":"泛型⚡️","type":"link","path":"ES6&TypeScript/typescript/generics.html"},{"text":"接口","type":"link","path":"ES6&TypeScript/typescript/interfaces.html"},{"text":"Shapes","type":"link","path":"ES6&TypeScript/typescript/shapes.html"},{"text":"类型推断","type":"link","path":"ES6&TypeScript/typescript/type_inference.html"},{"text":"类型关键字","type":"link","path":"ES6&TypeScript/typescript/type_keyword.html"},{"text":"装饰器","type":"link","path":"ES6&TypeScript/typescript/decorators.html"},{"text":"属性装饰器","type":"link","path":"ES6&TypeScript/typescript/property_decorators.html"},{"text":"类装饰器","type":"link","path":"ES6&TypeScript/typescript/class_decorators.html"},{"text":"参数装饰器","type":"link","path":"ES6&TypeScript/typescript/parameter_decorators.html"}]},{"text":"JavaScript工具链","type":"link","path":"tooling/tooling.html","children":[{"text":"源码控制： Git","type":"link","path":"tooling/source_control.html"},{"text":"命令行","type":"link","path":"tooling/the_command_line.html"},{"text":"JavaScript命令行： NodeJS","type":"link","path":"tooling/command_line_javascript.html"},{"text":"后端代码共享和分发： npm","type":"link","path":"tooling/back_end_code_sharing_and_distribution.html"},{"text":"模块加载， 打包和构建任务： Webpack","type":"link","path":"tooling/module_loading_bundling_and_build_tasks.html"},{"text":"Chrome","type":"link","path":"tooling/chrome.html"}]},{"text":"引导Angular应用","type":"link","path":"bootstrapping/bootstrapping.html","children":[{"text":"了解文件结构","type":"link","path":"bootstrapping/file_structure.html"},{"text":"引导Providers","type":"link","path":"bootstrapping/bootstrapping_providers.html"}]},{"text":"Angular 中的组件","type":"link","path":"Components/components.html","children":[{"text":"创建组件","type":"link","path":"Components/creating_components.html"},{"text":"组件的应用程序结构","type":"link","path":"Components/app_structure_with_components.html","children":[{"text":"将数据传递到组件","type":"link","path":"Components/passing_data_into_components.html"},{"text":"响应组件事件","type":"link","path":"Components/responding_to_component_events.html"},{"text":"使用双向数据绑定","type":"link","path":"Components/two_way_data_binding.html"},{"text":"从模板访问子组件","type":"link","path":"Components/access_child_components_from_template.html"}]},{"text":"投影","type":"link","path":"Components/projection.html"},{"text":"使用组件构建应用程序","type":"link","path":"Components/structuring_applications_with_components.html"},{"text":"使用其他组件","type":"link","path":"Components/using_other_components.html"}]},{"text":"指令","type":"link","path":"Directives/directives.html","children":[{"text":"属性指令","type":"link","path":"Directives/attribute_directives.html","children":[{"text":"NgStyle指令","type":"link","path":"Directives/ng_style_directive.html"},{"text":"NgClass指令","type":"link","path":"Directives/ng_class_directive.html"}]},{"text":"结构指令","type":"link","path":"Directives/structural_directives.html","children":[{"text":"NgIf指令","type":"link","path":"Directives/ng_if_directive.html"},{"text":"NgFor指令","type":"link","path":"Directives/ng_for_directive.html"},{"text":"NgSwitch指令","type":"link","path":"Directives/ng_switch_directives.html"},{"text":"使用多个结构指令","type":"link","path":"Directives/using_multiple_structural_directives.html"}]}]},{"text":"高级组件","type":"link","path":"advanced-components/advanced-components.html","children":[{"text":"组件生命周期","type":"link","path":"advanced-components/component_lifecycle.html"},{"text":"其他组件交互方式","type":"link","path":"advanced-components/access_child_components.html"},{"text":"视图封装","type":"link","path":"advanced-components/view_encapsulation.html"},{"text":"ElementRef","type":"link","path":"advanced-components/elementref.html"}]},{"text":"Observable","type":"link","path":"Observables/observables.html","children":[{"text":"使用Observable","type":"link","path":"Observables/using_observables.html"},{"text":"错误处理","type":"link","path":"Observables/error_handling.html"},{"text":"处理订阅和释放资源","type":"link","path":"Observables/disposing_subscriptions_and_releasing_resources.html"},{"text":"Observable VS Promise","type":"link","path":"Observables/observables_vs_promises.html"},{"text":"使用其他来源的Observable","type":"link","path":"Observables/using_observables_from_other_sources.html"},{"text":"可观察数组操作","type":"link","path":"Observables/observables_array_operations.html"},{"text":"“冷” vs“ 热” Observable","type":"link","path":"Observables/cold_vs_hot_observables.html"},{"text":"总结","type":"link","path":"Observables/summary.html"}]},{"text":"Angular 依赖注入","type":"link","path":"Di/di.html","children":[{"text":"什么是DI？","type":"link","path":"Di/what_is_di.html"},{"text":"DI框架","type":"link","path":"Di/di_framework.html"},{"text":"Angular 的DI","type":"link","path":"Di/angular2_di.html","children":[{"text":"@Inject() 和 @Injectable","type":"link","path":"Di/inject_and_injectable.html"},{"text":"类以外的注入","type":"link","path":"Di/injection_beyond_classes.html"},{"text":"避免注入冲突: OpaqueToken","type":"link","path":"Di/avoiding_collisions_opaque_token.html"},{"text":"注入树","type":"link","path":"Di/the_injector_tree.html"}]}]},{"text":"HTTP","type":"link","path":"Http/http.html","children":[{"text":"发起请求","type":"link","path":"Http/making_requests.html"},{"text":"捕获异常","type":"link","path":"Http/catching-rejections.html","children":[{"text":"捕获和释放","type":"link","path":"Http/catch_and_release.html"},{"text":"取消请求","type":"link","path":"Http/cancel_request.html"},{"text":"重试","type":"link","path":"Http/retry.html"}]},{"text":"拦截请求","type":"link","path":"Http/interceptor.html"},{"text":"进度事件","type":"link","path":"Http/progress.html"}]},{"text":"变化检测","type":"link","path":"Change-detection/Change_Detection.html","children":[{"text":"Angularjs与Angular的变化检测策略","type":"link","path":"Change-detection/angular_1_vs_angular_2.html"},{"text":"变化检测如何工作","type":"link","path":"Change-detection/how_change_detection_works.html"},{"text":"更改检测器类","type":"link","path":"Change-detection/change_detector_classes.html"},{"text":"变更检测策略： OnPush","type":"link","path":"Change-detection/change_detection_strategy_onpush.html"},{"text":"强制不变性","type":"link","path":"Change-detection/enforcing_immutability.html"},{"text":"其他资源","type":"link","path":"Change-detection/additional_resources.html"}]},{"text":"Zone.js","type":"link","path":"zone/zone.html","children":[{"text":"概述","type":"link","path":"zone/zone_primer.html"},{"text":"Zone 传播","type":"link","path":"zone/zone-propagation.html"},{"text":"跟踪异步操作","type":"link","path":"zone/tracking_async_operations.html"},{"text":"异步操作补丁","type":"link","path":"zone/patching_async_methods.html"},{"text":"上下文环境","type":"link","path":"zone/context_propagation.html"},{"text":"拦截","type":"link","path":"zone/interception.html"}]},{"text":"Angular 进阶","type":"link","path":"Advanced-angular/advanced-angular.html","children":[{"text":"指令","type":"link","path":"Advanced-angular/directives.html","children":[{"text":"创建属性指令","type":"link","path":"Advanced-angular/creating_an_attribute_directive.html","children":[{"text":"监听Host元素","type":"link","path":"Advanced-angular/listening_to_an_element_host.html"},{"text":"在指令中设置属性","type":"link","path":"Advanced-angular/setting_properties_in_a_directive.html"}]},{"text":"创建结构指令","type":"link","path":"Advanced-angular/creating_a_structural_directive.html","children":[{"text":"查看容器和嵌入视图","type":"link","path":"Advanced-angular/view_containers_and_embedded_views.html"},{"text":"向指令提供上下文变量","type":"link","path":"Advanced-angular/providing_context_variables_to_directives.html"}]}]},{"text":"AoT","type":"link","path":"Advanced-angular/aot.html","children":[{"text":"AoT局限","type":"link","path":"Advanced-angular/aot_limitations.html"},{"text":"AoT配置","type":"link","path":"Advanced-angular/aot_config.html"}]}]},{"text":"Immutable.js","type":"link","path":"Immutable/immutable.html","children":[{"text":"什么是不可变性？","type":"link","path":"Immutable/what_is_immutability.html"},{"text":"不变性的应用场景","type":"link","path":"Immutable/the_case_for_immutability.html"},{"text":"JavaScript解决方案","type":"link","path":"Immutable/javascript-solutions.html"},{"text":"Object.assign","type":"link","path":"Immutable/object_assign.html"},{"text":"Object.freeze","type":"link","path":"Immutable/object_freeze.html"},{"text":"Immutable.js基础","type":"link","path":"Immutable/immutable-js.html","children":[{"text":"Immutable.Map","type":"link","path":"Immutable/maps.html"},{"text":"Map.merge","type":"link","path":"Immutable/map_merge.html"},{"text":"嵌套对象","type":"link","path":"Immutable/nested-objects.html"},{"text":"删除密钥","type":"link","path":"Immutable/deleting_keys.html"},{"text":"Map是可迭代的","type":"link","path":"Immutable/maps_are_iterable.html"},{"text":"Immutable.List","type":"link","path":"Immutable/lists.html"},{"text":"性能和瞬态变化","type":"link","path":"Immutable/performance-transient-changes.html"},{"text":"官方文件","type":"link","path":"Immutable/official-documentation.html"}]}]},{"text":"管道","type":"link","path":"Pipes/pipes.html","children":[{"text":"使用管道","type":"link","path":"Pipes/using_pipes.html"},{"text":"自定义管道","type":"link","path":"Pipes/custom_pipes.html"},{"text":"状态管道","type":"link","path":"Pipes/stateful_and_async_pipes.html"}]},{"text":"表单","type":"link","path":"Form/form.html","children":[{"text":"入门","type":"link","path":"Form/getting-started.html"},{"text":"模板驱动的表单","type":"link","path":"Form/template-driven_forms.html","children":[{"text":"嵌套表单数据","type":"link","path":"Form/nested-form-data.html"},{"text":"使用模板模型绑定","type":"link","path":"Form/template-model-binding.html"},{"text":"验证模板驱动的表单","type":"link","path":"Form/validating_forms.html"}]},{"text":"响应式/模型驱动的表单","type":"link","path":"Form/reactive-forms.html","children":[{"text":"响应式表单基础","type":"link","path":"Form/reactive-forms_basics.html"},{"text":"验证响应式表单","type":"link","path":"Form/reactive-forms_validation.html"},{"text":"自定义验证响应式表单","type":"link","path":"Form/reactive-forms_custom_validation.html"}]},{"text":"用户的视觉提示","type":"link","path":"Form/visual_cues_for_users.html"}]},{"text":"模块","type":"link","path":"Modules/modules.html","children":[{"text":"什么是Angular模块？","type":"link","path":"Modules/introduction.html"},{"text":"将组件、 管道和服务添加到模块","type":"link","path":"Modules/multiple-elements.html"},{"text":"创建功能模块","type":"link","path":"Modules/feature-modules.html"},{"text":"指令复制","type":"link","path":"Modules/directive-duplications.html"},{"text":"延迟加载模块","type":"link","path":"Modules/lazy-loading-module.html"},{"text":"延迟加载和依赖注入树","type":"link","path":"Modules/lazy-load-di.html"},{"text":"共享模块和依赖注入","type":"link","path":"Modules/shared-modules-di.html"},{"text":"共享相同的依赖注入树","type":"link","path":"Modules/shared-di-tree.html"}]},{"text":"路由","type":"link","path":"Routing/routing.html","children":[{"text":"为什么选择路由？","type":"link","path":"Routing/why_routing.html"},{"text":"配置路由","type":"link","path":"Routing/config.html"},{"text":"将路由器重定向到另一条路由","type":"link","path":"Routing/redirects.html"},{"text":"定义路由之间的链接","type":"link","path":"Routing/routerlink.html"},{"text":"动态添加路由组件","type":"link","path":"Routing/routeroutlet.html"},{"text":"使用路由参数","type":"link","path":"Routing/routeparams.html"},{"text":"定义子路由","type":"link","path":"Routing/child_routes.html"},{"text":"路由拦截","type":"link","path":"Routing/route_guards.html"},{"text":"将可选参数传递给路由","type":"link","path":"Routing/query_params.html"},{"text":"使用辅助路由","type":"link","path":"Routing/aux-routes.html"}]},{"text":"状态管理","type":"link","path":"state-management/state-management.html","children":[{"text":"Redux 和 @ngrx","type":"link","path":"statemanagement/Redux.html"},{"text":"将 @ngrx添加到你的项目","type":"link","path":"statemanagement/adding_ngrx_to_your_project.html"},{"text":"定义应用的主状态","type":"link","path":"statemanagement/defining_your_main_application_state.html"},{"text":"示例应用","type":"link","path":"state-management/example_application.html"},{"text":"使用选择器读取应用程序状态","type":"link","path":"state-management/reading_your_application_state_using_selectors.html"},{"text":"Actions","type":"link","path":"state-management/actions.html"},{"text":"通过Dispatching Actions 修改应用 State","type":"link","path":"state-management/modifying_your_application_state_by_dispatching_actions.html"},{"text":"Reducers 和纯函数","type":"link","path":"state-management/reducers_and_pure_functions.html"},{"text":"Reducers 的 State 管理","type":"link","path":"state-management/reducers_as_state_management.html"},{"text":"创建应用的Root Reducer","type":"link","path":"state-management/creating_your_applications_root_reducer.html"},{"text":"配置你的应用","type":"link","path":"state-management/configuring_your_application.html"},{"text":"更多Redux和Ngrx资源","type":"link","path":"state-management/getting_more_from_redux_and_ngrx.html"}]},{"text":"动画","type":"link","path":"animation/index.html"},{"text":"TDD测试","type":"link","path":"Testing/testing.html","children":[{"text":"测试工具链","type":"link","path":"Testing/toolchain.html"},{"text":"测试设置","type":"link","path":"Testing/setup.html","children":[{"text":"文件名约定","type":"link","path":"Testing/filename-conventions.html"},{"text":"Karma配置","type":"link","path":"Testing/karma-config.html"},{"text":"TestBed配置（ 可选）","type":"link","path":"Testing/testbed-configuration.html"},{"text":"类型","type":"link","path":"Testing/typings.html"},{"text":"执行测试脚本","type":"link","path":"Testing/execute.html"}]},{"text":"简单测试","type":"link","path":"Testing/simple-test.html"},{"text":"使用Chai","type":"link","path":"Testing/using-chai.html"},{"text":"测试组件","type":"link","path":"Testing/components.html","children":[{"text":"检验方法和属性","type":"link","path":"Testing/verify.html"},{"text":"注入依赖和DOM更改","type":"link","path":"Testing/injecting-dependencies.html"},{"text":"覆盖测试的组件","type":"link","path":"Testing/overriding.html"},{"text":"测试异步操作","type":"link","path":"Testing/async.html"},{"text":"重构难以测试的代码","type":"link","path":"Testing/refactor.html"}]},{"text":"测试服务","type":"link","path":"Testing/services.html","children":[{"text":"服务测试策略","type":"link","path":"Testing/strategies.html"},{"text":"测试HTTP请求","type":"link","path":"Testing/http.html"},{"text":"使用MockBackend","type":"link","path":"Testing/mockbackend.html"},{"text":"替代HTTP Mock策略","type":"link","path":"Testing/alt-http-mocking.html"},{"text":"测试JSONP和XHR后端","type":"link","path":"Testing/json-xhr.html"},{"text":"异步执行测试","type":"link","path":"Testing/async -execution.html"}]},{"text":"测试Redux","type":"link","path":"Testing/redux.html","children":[{"text":"测试简单的Action","type":"link","path":"Testing/simple-actions.html"},{"text":"测试复杂的Action","type":"link","path":"Testing/complex-actions.html"},{"text":"测试Reducers","type":"link","path":"Testing/reducers.html"},{"text":"Afterthoughts","type":"link","path":"Testing/after-thoughts.html"}]}]},{"text":"项目设置","type":"link","path":"Project-setup/project-setup.html","children":[{"text":"Webpack","type":"link","path":"Project-setup/webpack.html"},{"text":"安装和使用","type":"link","path":"Project-setup/installation_and_usage.html"},{"text":"Loaders","type":"link","path":"Project-setup/loaders.html"},{"text":"插件","type":"link","path":"Project-setup/plugins.html"},{"text":"概要","type":"link","path":"Project-setup/summary.html"},{"text":"NPM脚本集成","type":"link","path":"Project-setup/npm_scripts_integration.html"}]},{"text":"Angular CLI","type":"link","path":"Angular-CLI/cli.html","children":[{"text":"创建","type":"link","path":"Angular-CLI/setup.html"},{"text":"创建新应用程序","type":"link","path":"Angular-CLI/creating-an-app.html"},{"text":"启动应用","type":"link","path":"Angular-CLI/serving-the-app.html"},{"text":"创建组件","type":"link","path":"Angular-CLI/creating-components.html"},{"text":"创建路由","type":"link","path":"Angular-CLI/creating-routes.html"},{"text":"创建其他东西","type":"link","path":"Angular-CLI/creating-other-things.html"},{"text":"测试","type":"link","path":"Angular-CLI/testing.html"},{"text":"Linting","type":"link","path":"Angular-CLI/linting.html"},{"text":"CLI命令概述","type":"link","path":"Angular-CLI/command-overview.html"},{"text":"添加第三方库","type":"link","path":"Angular-CLI/adding-third-party-libraries.html"},{"text":"集成现有应用程序","type":"link","path":"Angular-CLI/init.html"}]},{"text":"Angular 中的无障碍","type":"link","path":"a11y/a11y.html","children":[{"text":"为什么需要无障碍","type":"link","path":"a11y/why-a11y.html"}]},{"text":"Angular 中的国际化","type":"link","path":"i18n/i18n.html","children":[{"text":"过程什么样的， 如何参与？","type":"link","path":"i18n/process-and-roles.html"},{"text":"在我们的模板中标记文字","type":"link","path":"i18n/marking-text-in -templates.html"},{"text":"使用Angular CLI提取翻译文本","type":"link","path":"i18n/translation-text-extraction.html"},{"text":"如何导入已完成的翻译文件","type":"link","path":"i18n/import -translation - files.html ","children":[{"text":"使用AoT编译器","type":"link","path":"i18n/import -using - aot.html "},{"text":"使用JiT编译器","type":"link","path":"i18n/import -using - jit.html "}]}]},{"text":"词汇表","type":"link","path":"glossary.html"},{"text":"最佳实践与填坑的积累⚡️","type":"link","path":"practice.html"},{"text":"进一步阅读和参考","type":"link","path":"further-reading.html"}]}},"config":{"timezone":"UTC","root":"/","time_format":"HH:mm:ss","theme":"../node_modules/hexo-theme-doc","theme_config":{"swagger_ui":{"version":2,"permalinks":true,"api_explorer":true,"download":"Download specification","show_extensions":false,"deep_linking":true,"display_operation_id":false,"doc_expansion":"none"},"search":{"skip":false,"background":false,"route":"/lunr.json"},"favicon":"images/favicon.ico","google_analytics":"UA-85094676-2"}}}</script>

    <div id="react-navigation-root"><div class="doc-navigation" data-reactroot=""><nav class="doc-navbar"><a href="/index.html" class="doc-navbar__logo"><img src="/images/logo.png" class="doc-navbar__logo__img"><span class="doc-navbar__logo__text">Angular</span></a><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close doc-navbar__sidebar-close--desktop"></i><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"></div><ul class="doc-sidebar-list"></ul></div></nav></div></div>
    <div class="doc-content">
  <div class="dc-page">
    <div class="dc-card">
      <div id="react-search-results-root"></div>
      <div id="page-content" class="doc-formatting">
        <h1 id="Zones"><a href="#Zones" class="headerlink" title="Zones"></a>Zones</h1><p><a href="https://github.com/angular/zone.js" target="_blank" rel="noopener">Zone.js</a> 提供了一种称为区域的机制，用于封装和拦截浏览器中的异步活动（例如setTimeout，promise）。</p>
<p>这些区域是执行上下文，允许Angular跟踪异步活动的开始和完成，并根据需要执行任务（例如，变化检测）。 Zone.js提供了一个全局区域，可以被 fork 和扩展以进一步封装/隔离异步行为，Angular在其<strong>NgZone</strong>服务中通过创建一个fork并使用自己的行为扩展它。</p>
<p><strong>NgZone</strong>服务为我们提供了一些Observable和方法来确定Angular的区域的状态，并在Angular的区域内外以不同的方式执行代码。</p>
<p>重要的是要知道Zone.js通过<a href="https://en.wikipedia.org/wiki/Monkey_patch" target="_blank" rel="noopener">Monkey Patching（猴子补丁）</a>来对浏览器中的常见方法和元素进行拦截，例如<code>setTimeout</code>和<code>HTMLElement.prototype.onclick</code>。 这些拦截可能导致外部库和Angular之间的意外行为。 在某些情况下，可能优先在Angular的区域外执行第三方方法（见下文）。</p>
<h2 id="在-Zone-内"><a href="#在-Zone-内" class="headerlink" title="在 Zone 内"></a>在 Zone 内</h2><p>NgZone公开了一组Observable，允许我们确定Angular’s区域的当前状态或稳定性。</p>
<ul>
<li>onUnstable - 当代码已经进入并正在Angular区域内执行时通知。</li>
<li>onMicrotaskEmpty - 当没有更多的微任务被排队执行时通知。 Angular在内部订阅，表示它应该运行变化检测。</li>
<li>onStable - 在最后一个onMicroTaskEmpty运行时通知，表示所有任务已完成，并且已发生变化检测。</li>
<li>onError - 在发生错误时通知。 Angular在内部订阅，以将未捕获的错误发送到自己的错误处理程序，即您在控制台中看到的错误，前缀为“EXCEPTION：”。</li>
</ul>
<p>我们订阅这些注入了<strong>NgZone</strong>的组件，服务等。 并订阅公共Observables。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable, NgZone &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> OurZoneWatchingService() &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> ngZone: NgZone</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.ngZone.onStable.subscribe(<span class="keyword">this</span>.onZoneStable);</span><br><span class="line">    <span class="keyword">this</span>.ngZone.onUnstable.subscribe(<span class="keyword">this</span>.onZoneUnstable);  </span><br><span class="line">    <span class="keyword">this</span>.ngZone.onError.subscribe(<span class="keyword">this</span>.onZoneError);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onZoneStable() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'We are stable'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onZoneUnstable() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'We are unstable'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onZoneError(error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'Error'</span>, error <span class="keyword">instanceof</span> <span class="built_in">Error</span> ? error.message : error.toString());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>订阅这些可以帮助您确定代码是否意外触发了不影响应用程序状态的变化检测。</p>
<h2 id="变化检测"><a href="#变化检测" class="headerlink" title="变化检测"></a>变化检测</h2><p>因为从Angular的区域内执行的所有异步代码都可以触发变化检测，所以当不需要变化检测时，您可能更喜欢在Angular的区域之外执行一些代码。</p>
<p>为了在Angular的上下文之外运行代码，<strong>NgZone</strong>提供了一个名为<strong>runOutsideAngular</strong>的方法。 使用此方法，Angular的区域不会与您的代码交互，并且在全局区域变得稳定时不会接收事件。</p>
<p>在这个 <a href="http://plnkr.co/edit/d3KGMh?p=preview" target="_blank" rel="noopener">例子</a>中，你将在日志中看到当代码运行在它的外部时，Angular的区域会发生什么。</p>
<p>你会注意到，在这两种情况下，点击按钮导致Angular区域变得不稳定，由于Zone.js补丁和监听<strong>HTMLElement.prototype.onclick</strong>，但是在Angular的区域之外执行的<strong>setInterval</strong>不会影响它的稳定性，并且不会触发变化检测 。</p>
<h2 id="Debugging"><a href="#Debugging" class="headerlink" title="Debugging"></a>Debugging</h2><p>通常，在异步事件链期间抛出的异常将仅包括在当前方法的堆栈跟踪中。</p>
<p>使用Zone.js跟踪所有的异步调用，它可以为我们提供更长，更详细的事件和调用的堆栈跟踪，让我们更容易找到导致异常的原因。</p>
<p>要在开发中启用长堆栈跟踪，您应该在代码中包括<strong>long-stack-trace-zone</strong>模块。 但最好不要包括在您的生产构建中，Angular将跳过设置更长的堆栈跟踪在生产模式（<code>@angular/core</code>中的<code>enableProdMode</code>）。</p>
<p>Angular will take care of forking and extending its own zone to display more meaningful stack traces.</p>
<p>Angular将负责分叉 forking 并扩展其自己的区域以显示更有意义的堆栈跟踪。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (__PRODUCTION__) &#123;</span><br><span class="line">  enableProdMode();</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  require(&apos;zone.js/dist/long-stack-trace-zone&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用下面的代码，我们首先调用<code>startAsync</code>，触发一个<code>setTimeouts</code>链，导致一个未捕获的错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function startAsync() &#123;</span><br><span class="line">  setTimeout(stepOne, 100);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function stepOne() &#123;</span><br><span class="line">  setTimeout(stepTwo, 100);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function stepTwo() &#123;</span><br><span class="line">  throw new Error(&apos;Finished&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="简单堆栈跟踪"><a href="#简单堆栈跟踪" class="headerlink" title="简单堆栈跟踪"></a>简单堆栈跟踪</h3><p>这是一个典型的堆栈跟踪，您将在此场景中看到，没有Zone，只显示发生未处理异常的函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Uncaught Error: Finished(…)</span><br><span class="line">  stepTwo @ debugging.html:28</span><br></pre></td></tr></table></figure>
<h3 id="详细的“长”堆栈跟踪"><a href="#详细的“长”堆栈跟踪" class="headerlink" title="详细的“长”堆栈跟踪"></a>详细的“长”堆栈跟踪</h3><p>在下面的堆栈跟踪中，您可以看到在这个异步函数调用链中发生的事件的顺序，添加了“&gt;&gt;”以指出我们的函数。</p>
<p>你会注意到这个堆栈跟踪包括更多的信息，包括Zone自己的任务管理（例如<code>onScheduleTask</code>），以及从函数排队到执行时间的时间。</p>
<p>通过这个更长的堆栈跟踪可以帮助你调试Angular的特性，异步交互代码，并有助于更精确定位问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">debugging.html:16 Error: Finished</span><br><span class="line">&gt;&gt;  at stepTwo (http://localhost:3030/examples/debugging.html:28:15)</span><br><span class="line">    at ZoneDelegate.invokeTask (http://localhost:3030/node_modules/zone.js/dist/zone.js:265:35)</span><br><span class="line">    at Zone.runTask (http://localhost:3030/node_modules/zone.js/dist/zone.js:154:47)</span><br><span class="line">    at ZoneTask.invoke (http://localhost:3030/node_modules/zone.js/dist/zone.js:335:33)</span><br><span class="line">    at data.args.(anonymous function) (http://localhost:3030/node_modules/zone.js/dist/zone.js:970:25)</span><br><span class="line">  -------------   Elapsed: 101 ms; At: Wed Nov 16 2016 08:23:17 GMT-0500 (EST)   -------------  </span><br><span class="line">    at Object.onScheduleTask (http://localhost:3030/node_modules/zone.js/dist/long-stack-trace-zone.js:83:18)</span><br><span class="line">    at ZoneDelegate.scheduleTask (http://localhost:3030/node_modules/zone.js/dist/zone.js:242:49)</span><br><span class="line">    at Zone.scheduleMacroTask (http://localhost:3030/node_modules/zone.js/dist/zone.js:171:39)</span><br><span class="line">    at http://localhost:3030/node_modules/zone.js/dist/zone.js:991:33</span><br><span class="line">    at setTimeout (eval at createNamedFn (http://localhost:3030/node_modules/zone.js/dist/zone.js:927:17), &lt;anonymous&gt;:3:37)</span><br><span class="line">&gt;&gt;  at stepOne (http://localhost:3030/examples/debugging.html:23:9)</span><br><span class="line">    at ZoneDelegate.invokeTask (http://localhost:3030/node_modules/zone.js/dist/zone.js:265:35)</span><br><span class="line">    at Zone.runTask (http://localhost:3030/node_modules/zone.js/dist/zone.js:154:47)</span><br><span class="line">  -------------   Elapsed: 105 ms; At: Wed Nov 16 2016 08:23:17 GMT-0500 (EST)   -------------  </span><br><span class="line">    at Object.onScheduleTask (http://localhost:3030/node_modules/zone.js/dist/long-stack-trace-zone.js:83:18)</span><br><span class="line">    at ZoneDelegate.scheduleTask (http://localhost:3030/node_modules/zone.js/dist/zone.js:242:49)</span><br><span class="line">    at Zone.scheduleMacroTask (http://localhost:3030/node_modules/zone.js/dist/zone.js:171:39)</span><br><span class="line">    at http://localhost:3030/node_modules/zone.js/dist/zone.js:991:33</span><br><span class="line">    at setTimeout (eval at createNamedFn (http://localhost:3030/node_modules/zone.js/dist/zone.js:927:17), &lt;anonymous&gt;:3:37)</span><br><span class="line">&gt;&gt;  at startAsync (http://localhost:3030/examples/debugging.html:33:9)</span><br><span class="line">    at ZoneDelegate.invoke (http://localhost:3030/node_modules/zone.js/dist/zone.js:232:26)</span><br><span class="line">    at Zone.run (http://localhost:3030/node_modules/zone.js/dist/zone.js:114:43)</span><br></pre></td></tr></table></figure>
        <div id="react-support-footer-root"></div>
      </div>
    </div>
  </div>
</div>

    
<script>
  if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-85094676-2', 'auto');
    ga('send', 'pageview');
  }
</script>



    

    <!-- js vendors -->
    <script src="//code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.0/lunr.min.js"></script>

    <!-- js source  -->
    <script src="/script/doc.js"></script>

    

  </body>
</html>
